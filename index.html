<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário de Pedido de Material - Almoxarifado</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background-color: #f0f2f5; }
        .container { max-width: 800px; }
        .card-header { background-color: #0d6efd; color: white; }
        .outro-input { display: none; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="container mt-5 mb-5">
        <div class="card shadow-sm">
            <div class="card-header text-center">
                <h3><i class="fas fa-box-open"></i> Formulário de Pedido de Material</h3>
                <p class="mb-0">Secretaria de Desenvolvimento</p>
            </div>
            <div class="card-body p-4">
                <form id="pedidoForm">
                    <h5 class="mb-3">Informações do Solicitante</h5>
                    <div class="row">
                        <div class="col-md-6 mb-3"><label for="solicitante" class="form-label">Nome Completo</label><input type="text" class="form-control" id="solicitante" required></div>
                        <div class="col-md-6 mb-3"><label for="setor" class="form-label">Setor</label><select class="form-select" id="setor" required><option value="" selected disabled>Selecione...</option><option>Administrativo</option><option>Financeiro</option><option>RH</option><option>TI</option><option>Operacional</option></select></div>
                    </div>
                    <hr>
                    <h5 class="mb-3">Itens do Pedido</h5>
                    <div id="itens-container"></div>
                    <button type="button" class="btn btn-primary btn-sm" id="adicionarItem"><i class="fas fa-plus"></i> Adicionar Item</button>
                    <hr>
                    <div class="mb-3"><label for="justificativa" class="form-label">Justificativa / Observações</label><textarea class="form-control" id="justificativa" rows="3"></textarea></div>
                    <div class="d-grid gap-2 mt-4"><button type="submit" class="btn btn-success btn-lg" id="btn-enviar"><i class="fas fa-paper-plane"></i> Enviar Pedido</button></div>
                </form>
                <div id="alerta" class="mt-3" style="display: none;"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // URL DO SEU SCRIPT CORRETA E INSERIDA
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwCRTFvWoqJfh61F_Dg1rv4iQYNHG_ytR3RFbevZwyigRVCXf62Wi4sfrNLCx2OPv-N/exec"; 
        
        const materiaisCategorizados = {
            "Material de Escritório": ["Apagador para quadro branco", "Apontador", "Bloco adesivo (postit)", "Bloco pauta grande", "Bloco pauta pequeno", "Borracha", "Caixa arquivo morto azul", "Caixa arquivo morto vermelha", "Caneta azul", "Caneta para quadro branco azul", "Caneta para quadro branco preto", "Caneta para quadro branco vermelho", "Caneta preta", "Caneta vermelha", "Capa PP para encadernação A4 Azul", "Capa PP para encadernação A4 Transparente", "Clips", "Cola bastão", "Cola branca", "Envelope Kraft - A4", "Envelope kraft - ofício", "Envelope kraft - pequeno", "Envelope plástico", "Espiral para encadernação", "Estilete", "Extrator de Grampos", "Fita corretiva", "Fita durex transparente 12x30", "Fita durex transparente 48x45", "Grampeador", "Grampo para grampeador", "Grampo trilho plástico branco", "Grampo trilho plástico preto", "Lápis preto", "Marca texto - amarelo", "Marca texto - rosa", "Papel A4 (Caixa c/10 Pct de 500fls)", "Papel Filipaper 180Gr", "Pasta canaleta", "Pasta cartolina azul com elástico", "Pasta L Cristal Tamanho A4 220x310mm", "Pasta polionda azul com elástico", "Pct plástico filme p/ plastificação tam. A4", "Pct plástico filme p/ plastificação tam. documentos", "Pen Drive 16GB", "Pilha AA", "Pilha AAA", "Porta Canetas", "Régua", "Tesoura 21 cm"],
            "Material para Copa": ["Açúcar 1Kg", "Açúcar sachê", "Adoçante líquido", "Adoçante sachê", "Água mineral com gás", "Água mineral sem gás", "Café", "Coador de café de Pano"],
            "Material de Limpeza": ["Água sanitária", "Álcool 1 lt", "Álcool gel", "Luva látex"]
        };

        const form = document.getElementById('pedidoForm');
        const btnAdicionarItem = document.getElementById('adicionarItem');
        const itensContainer = document.getElementById('itens-container');
        const btnEnviar = document.getElementById('btn-enviar');
        const alerta = document.getElementById('alerta');

        function criarOpcoesDeMaterial() {
            let html = '<option value="" selected disabled>Selecione um item...</option>';
            for (const categoria in materiaisCategorizados) {
                html += `<optgroup label="${categoria}">`;
                materiaisCategorizados[categoria].forEach(item => { html += `<option value="${item}">${item}</option>`; });
                html += `</optgroup>`;
            }
            html += '<option value="Outros">Outros</option>';
            return html;
        }
        const materialOptionsHtml = criarOpcoesDeMaterial();

        const adicionarItem = () => {
            const itemDiv = document.createElement('div');
            itemDiv.classList.add('item-row', 'mb-3');
            itemDiv.innerHTML = `<div class="input-group"><select class="form-select item-select" required>${materialOptionsHtml}</select><input type="number" class="form-control" placeholder="Qtd." min="1" required style="max-width: 100px;"><button class="btn btn-danger" type="button" onclick="this.closest('.item-row').remove()"><i class="fas fa-trash"></i></button></div><input type="text" class="form-control outro-input" placeholder="Especifique o outro item">`;
            itensContainer.appendChild(itemDiv);

            itemDiv.querySelector('.item-select').addEventListener('change', function() {
                const outroInput = this.closest('.item-row').querySelector('.outro-input');
                outroInput.style.display = this.value === 'Outros' ? 'block' : 'none';
                outroInput.required = this.value === 'Outros';
            });
        };
        
        btnAdicionarItem.addEventListener('click', adicionarItem);
        adicionarItem();

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            btnEnviar.disabled = true;
            btnEnviar.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Enviando...';

            const data = {
                solicitante: document.getElementById('solicitante').value,
                setor: document.getElementById('setor').value,
                justificativa: document.getElementById('justificativa').value,
                itens: []
            };

            itensContainer.querySelectorAll('.item-row').forEach(row => {
                let nome = row.querySelector('.item-select').value;
                if (nome === 'Outros') { nome = row.querySelector('.outro-input').value.trim(); }
                const qtd = row.querySelector('input[type="number"]').value;
                if (nome && qtd > 0) data.itens.push({ nome, qtd });
            });

            fetch(SCRIPT_URL, { method: 'POST', mode: 'cors', body: JSON.stringify(data) })
                .then(res => res.json())
                .then(response => {
                    alerta.style.display = 'block';
                    if (response.result === 'success') {
                        alerta.className = 'alert alert-success';
                        alerta.innerHTML = '<strong>Sucesso!</strong> Seu pedido foi enviado.';
                        form.reset();
                        itensContainer.innerHTML = '';
                        adicionarItem();
                    } else { throw new Error(response.message); }
                })
                .catch(error => {
                    alerta.style.display = 'block';
                    alerta.className = 'alert alert-danger';
                    alerta.innerHTML = `<strong>Erro!</strong> Não foi possível enviar. Detalhe: ${error.message}`;
                })
                .finally(() => {
                    btnEnviar.disabled = false;
                    btnEnviar.innerHTML = '<i class="fas fa-paper-plane"></i> Enviar Pedido';
                });
        });
    </script>
</body>
</html>
