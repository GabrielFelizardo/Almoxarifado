<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Almoxarifado - Secretaria de Desenvolvimento</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: 10px 10px 0 0;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            padding: 15px 10px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            border-right: 1px solid #ddd;
            min-width: 120px;
        }

        .tab:last-child {
            border-right: none;
        }

        .tab.active {
            background: white;
            color: #667eea;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab-content {
            background: white;
            padding: 30px;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            min-height: 600px;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #495057;
        }

        input, select, textarea {
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn-small {
            padding: 8px 15px;
            font-size: 12px;
        }

        .btn-success {
            background: linear-gradient(45deg, #28a745, #20c997);
        }

        .btn-danger {
            background: linear-gradient(45deg, #dc3545, #fd7e14);
        }

        .btn-info {
            background: linear-gradient(45deg, #17a2b8, #6610f2);
        }

        .calculator {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #667eea;
        }

        .calculator h3 {
            margin-bottom: 15px;
            color: #495057;
        }

        .calc-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            align-items: end;
        }

        .calc-input {
            text-align: center;
            font-weight: 600;
        }

        .result {
            background: #e3f2fd;
            border: 2px solid #2196f3;
            font-weight: bold;
            text-align: center;
            font-size: 18px;
            color: #1976d2;
        }

        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }

        .inventory-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .inventory-table th,
        .inventory-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .inventory-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
            position: sticky;
            top: 0;
        }

        .inventory-table tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-proprio {
            background: #d4edda;
            color: #155724;
        }

        .status-alugado {
            background: #fff3cd;
            color: #856404;
        }

        .status-vencido {
            background: #f8d7da;
            color: #721c24;
        }

        .search-box {
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
            background: white;
        }

        .export-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: linear-gradient(45deg, #fff, #f8f9fa);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-top: 4px solid #667eea;
        }

        .summary-card h3 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .summary-card p {
            color: #666;
            font-weight: 600;
        }

        .alert {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            border-left: 5px solid;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-color: #28a745;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-color: #ffc107;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border-color: #dc3545;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                border-right: none;
                border-bottom: 1px solid #ddd;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .calc-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì¶ Sistema de Almoxarifado</h1>
            <p>Secretaria de Desenvolvimento - Controle Integrado de Materiais e Loca√ß√µes</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('dashboard')">üìä Dashboard</button>
            <button class="tab" onclick="showTab('cadastro')">‚ûï Cadastro</button>
            <button class="tab" onclick="showTab('locacao')">üè¢ Loca√ß√£o</button>
            <button class="tab" onclick="showTab('inventario')">üìã Invent√°rio</button>
            <button class="tab" onclick="showTab('calculadora')">üßÆ Calculadora</button>
            <button class="tab" onclick="showTab('relatorios')">üìà Relat√≥rios</button>
        </div>

        <div class="tab-content">
            <!-- DASHBOARD -->
            <div id="dashboard" class="tab-pane active">
                <h2>üìä Dashboard - Vis√£o Geral do Almoxarifado</h2>
                
                <div class="summary-cards">
                    <div class="summary-card">
                        <h3 id="total-itens">0</h3>
                        <p>Total de Itens</p>
                    </div>
                    <div class="summary-card">
                        <h3 id="itens-proprios">0</h3>
                        <p>Itens Pr√≥prios</p>
                    </div>
                    <div class="summary-card">
                        <h3 id="itens-alugados">0</h3>
                        <p>Itens Alugados</p>
                    </div>
                    <div class="summary-card">
                        <h3 id="valor-total">R$ 0,00</h3>
                        <p>Valor Total Estoque</p>
                    </div>
                </div>

                <input type="text" class="search-box" placeholder="üîç Buscar item no invent√°rio... (digite c√≥digo, nome ou categoria)" id="search-input">

                <div id="alertas-container"></div>

                <div class="table-container">
                    <table class="inventory-table" id="dashboard-table">
                        <thead>
                            <tr>
                                <th>C√≥digo</th>
                                <th>Item</th>
                                <th>Categoria</th>
                                <th>Quantidade</th>
                                <th>Valor Unit.</th>
                                <th>Valor Total</th>
                                <th>Status</th>
                                <th>Localiza√ß√£o</th>
                            </tr>
                        </thead>
                        <tbody id="inventory-tbody">
                            <!-- Itens ser√£o carregados via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- CADASTRO DE MATERIAIS -->
            <div id="cadastro" class="tab-pane">
                <h2>‚ûï Cadastro de Materiais Pr√≥prios</h2>
                
                <form id="form-cadastro">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>C√≥digo do Item *</label>
                            <input type="text" id="codigo" required placeholder="Ex: ESC001, INF001">
                        </div>
                        <div class="form-group">
                            <label>Categoria *</label>
                            <select id="categoria" required>
                                <option value="">Selecione...</option>
                                <option value="escritorio">üìù Material de Escrit√≥rio</option>
                                <option value="informatica">üíª Inform√°tica</option>
                                <option value="mobiliario">ü™ë Mobili√°rio</option>
                                <option value="evento">üéâ Material para Eventos</option>
                                <option value="limpeza">üßΩ Material de Limpeza</option>
                                <option value="outros">üì¶ Outros</option>
                            </select>
                        </div>
                        <div class="form-group full-width">
                            <label>Nome/Descri√ß√£o do Item *</label>
                            <input type="text" id="nome-item" required placeholder="Descri√ß√£o completa do item">
                        </div>
                        <div class="form-group">
                            <label>Quantidade *</label>
                            <input type="number" id="quantidade" min="1" required>
                        </div>
                        <div class="form-group">
                            <label>Unidade *</label>
                            <select id="unidade" required>
                                <option value="un">Unidade</option>
                                <option value="cx">Caixa</option>
                                <option value="kg">Quilograma</option>
                                <option value="lt">Litro</option>
                                <option value="m">Metro</option>
                                <option value="resma">Resma</option>
                                <option value="pct">Pacote</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Valor Unit√°rio (R$)</label>
                            <input type="number" id="valor-unitario" step="0.01" min="0" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label>Localiza√ß√£o</label>
                            <input type="text" id="localizacao" placeholder="Ex: Arm√°rio 1, Prateleira A">
                        </div>
                        <div class="form-group">
                            <label>Fornecedor</label>
                            <input type="text" id="fornecedor" placeholder="Nome da empresa fornecedora">
                        </div>
                        <div class="form-group">
                            <label>Nota Fiscal</label>
                            <input type="text" id="nota-fiscal" placeholder="N√∫mero da NF">
                        </div>
                        <div class="form-group full-width">
                            <label>Observa√ß√µes</label>
                            <textarea id="observacoes" rows="3" placeholder="Informa√ß√µes adicionais sobre o item"></textarea>
                        </div>
                    </div>
                    <div style="text-align: center;">
                        <button type="submit">üíæ Cadastrar Item no Almoxarifado</button>
                        <button type="button" onclick="limparFormulario()" style="margin-left: 10px; background: #6c757d;">üóëÔ∏è Limpar Formul√°rio</button>
                    </div>
                </form>
            </div>

            <!-- CONTROLE DE LOCA√á√ÉO -->
            <div id="locacao" class="tab-pane">
                <h2>üè¢ Controle de Loca√ß√µes para Eventos</h2>
                
                <form id="form-locacao">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Nome do Evento *</label>
                            <input type="text" id="evento-nome" required placeholder="Ex: Workshop de Empreendedorismo">
                        </div>
                        <div class="form-group">
                            <label>Data do Evento *</label>
                            <input type="date" id="evento-data" required>
                        </div>
                        <div class="form-group">
                            <label>Empresa Locadora *</label>
                            <input type="text" id="empresa-locadora" required placeholder="Nome da empresa">
                        </div>
                        <div class="form-group">
                            <label>Contato da Empresa</label>
                            <input type="text" id="contato-empresa" placeholder="Telefone ou email">
                        </div>
                        <div class="form-group full-width">
                            <label>Item/Equipamento Locado *</label>
                            <input type="text" id="item-locado" required placeholder="Descri√ß√£o do item locado">
                        </div>
                        <div class="form-group">
                            <label>Quantidade *</label>
                            <input type="number" id="qtd-locada" min="1" required>
                        </div>
                        <div class="form-group">
                            <label>Valor Total da Loca√ß√£o (R$) *</label>
                            <input type="number" id="valor-locacao" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label>Data/Hora de Entrega *</label>
                            <input type="datetime-local" id="data-entrega" required>
                        </div>
                        <div class="form-group">
                            <label>Data/Hora de Devolu√ß√£o *</label>
                            <input type="datetime-local" id="data-devolucao" required>
                        </div>
                        <div class="form-group full-width">
                            <label>Observa√ß√µes da Loca√ß√£o</label>
                            <textarea id="obs-locacao" rows="3" placeholder="Condi√ß√µes especiais, acess√≥rios inclusos, etc."></textarea>
                        </div>
                    </div>
                    <div style="text-align: center;">
                        <button type="submit">üìã Registrar Loca√ß√£o</button>
                    </div>
                </form>

                <h3>üìã Loca√ß√µes Ativas e Pendentes</h3>
                <div class="table-container">
                    <table class="inventory-table">
                        <thead>
                            <tr>
                                <th>Evento</th>
                                <th>Item</th>
                                <th>Empresa</th>
                                <th>Valor</th>
                                <th>Data Evento</th>
                                <th>Devolu√ß√£o</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="locacoes-tbody">
                            <!-- Loca√ß√µes ser√£o carregadas via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- INVENT√ÅRIO COMPLETO -->
            <div id="inventario" class="tab-pane">
                <h2>üìã Invent√°rio Completo do Almoxarifado</h2>
                
                <div class="export-buttons">
                    <button class="btn-success" onclick="exportarDados()">üìä Exportar Relat√≥rio Excel</button>
                    <button class="btn-info" onclick="imprimirInventario()">üñ®Ô∏è Imprimir Lista</button>
                    <button class="btn-info" onclick="backupDados()">üíæ Backup dos Dados</button>
                </div>

                <div class="form-group" style="max-width: 300px;">
                    <label>üîç Filtrar por Categoria</label>
                    <select id="filtro-categoria" onchange="filtrarInventario()">
                        <option value="">üì¶ Todas as categorias</option>
                        <option value="escritorio">üìù Material de Escrit√≥rio</option>
                        <option value="informatica">üíª Inform√°tica</option>
                        <option value="mobiliario">ü™ë Mobili√°rio</option>
                        <option value="evento">üéâ Material para Eventos</option>
                        <option value="limpeza">üßΩ Material de Limpeza</option>
                        <option value="alugado">üè¢ Itens Alugados</option>
                        <option value="outros">üì¶ Outros</option>
                    </select>
                </div>

                <div class="table-container">
                    <table class="inventory-table">
                        <thead>
                            <tr>
                                <th>C√≥digo</th>
                                <th>Item/Descri√ß√£o</th>
                                <th>Categoria</th>
                                <th>Quantidade</th>
                                <th>Unidade</th>
                                <th>Valor Unit.</th>
                                <th>Valor Total</th>
                                <th>Status</th>
                                <th>Localiza√ß√£o</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="inventario-completo">
                            <!-- Invent√°rio ser√° carregado via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- CALCULADORAS -->
            <div id="calculadora" class="tab-pane">
                <h2>üßÆ Calculadoras de Apoio Financeiro</h2>
                
                <div class="calculator">
                    <h3>üí∞ Calculadora de Valor Total</h3>
                    <div class="calc-grid">
                        <div class="form-group">
                            <label>Quantidade:</label>
                            <input type="number" id="calc-qtd" class="calc-input" oninput="calcularTotal()" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label>Valor Unit√°rio (R$):</label>
                            <input type="number" id="calc-valor" class="calc-input" step="0.01" oninput="calcularTotal()" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label>Valor Total:</label>
                            <input type="text" id="calc-total" class="result" readonly>
                        </div>
                    </div>
                </div>

                <div class="calculator">
                    <h3>üìä Or√ßamento de Loca√ß√£o M√∫ltipla</h3>
                    <div id="itens-orcamento">
                        <div class="calc-grid">
                            <div class="form-group">
                                <label>Item:</label>
                                <input type="text" placeholder="Nome do item" class="item-nome">
                            </div>
                            <div class="form-group">
                                <label>Qtd:</label>
                                <input type="number" min="1" value="1" class="item-qtd" oninput="calcularOrcamento()">
                            </div>
                            <div class="form-group">
                                <label>Valor Unit. (R$):</label>
                                <input type="number" step="0.01" class="item-valor" oninput="calcularOrcamento()">
                            </div>
                            <div class="form-group">
                                <label>Dias:</label>
                                <input type="number" min="1" value="1" class="item-dias" oninput="calcularOrcamento()">
                            </div>
                        </div>
                    </div>
                    <button onclick="adicionarItemOrcamento()" class="btn-success">‚ûï Adicionar Item ao Or√ßamento</button>
                    
                    <div class="calc-grid" style="margin-top: 20px;">
                        <div class="form-group">
                            <label>Subtotal:</label>
                            <input type="text" id="orcamento-subtotal" class="result" readonly>
                        </div>
                        <div class="form-group">
                            <label>Desconto (%):</label>
                            <input type="number" id="desconto" min="0" max="100" oninput="calcularOrcamento()" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label>Total Final:</label>
                            <input type="text" id="orcamento-total" class="result" readonly>
                        </div>
                    </div>
                </div>

                <div class="calculator">
                    <h3>üìà An√°lise: Comprar vs Alugar</h3>
                    <div class="calc-grid">
                        <div class="form-group">
                            <label>Valor para Comprar (R$):</label>
                            <input type="number" id="valor-compra" step="0.01" oninput="analisarCustos()" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label>Valor Loca√ß√£o por Evento (R$):</label>
                            <input type="number" id="valor-locacao-evento" step="0.01" oninput="analisarCustos()" placeholder="0,00">
                        </div>
                        <div class="form-group">
                            <label>Usos estimados por ano:</label>
                            <input type="number" id="uso-ano" min="1" oninput="analisarCustos()" placeholder="0">
                        </div>
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label>üí° Recomenda√ß√£o:</label>
                            <input type="text" id="recomendacao" class="result" readonly>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RELAT√ìRIOS -->
            <div id="relatorios" class="tab-pane">
                <h2>üìà Relat√≥rios e An√°lises Gerenciais</h2>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label>üìÖ Per√≠odo - De:</label>
                        <input type="date" id="periodo-de">
                    </div>
                    <div class="form-group">
                        <label>üìÖ Per√≠odo - At√©:</label>
                        <input type="date" id="periodo-ate">
                    </div>
                </div>

                <div class="export-buttons">
                    <button onclick="gerarRelatorioMovimentacao()" class="btn-success">üìä Relat√≥rio de Movimenta√ß√£o</button>
                    <button onclick="gerarRelatorioLocacoes()" class="btn-info">üè¢ Relat√≥rio de Loca√ß√µes</button>
                    <button onclick="gerarRelatorioValores()" class="btn-success">üí∞ Relat√≥rio Financeiro</button>
                    <button onclick="gerarRelatorioCompleto()" class="btn-info">üìã Relat√≥rio Completo</button>
                </div>

                <div id="relatorio-output">
                    <h3>üìà Resumo Executivo do Per√≠odo</h3>
                    <div class="summary-cards">
                        <div class="summary-card">
                            <h3 id="total-gasto-locacao">R$ 0,00</h3>
                            <p>Gasto Total em Loca√ß√µes</p>
                        </div>
                        <div class="summary-card">
                            <h3 id="total-eventos">0</h3>
                            <p>Eventos Realizados</p>
                        </div>
                        <div class="summary-card">
                            <h3 id="economia-estimada">R$ 0,00</h3>
                            <p>Economia com Materiais Pr√≥prios</p>
                        </div>
                        <div class="summary-card">
                            <h3 id="media-evento">R$ 0,00</h3>
                            <p>Custo M√©dio por Evento</p>
                        </div>
                    </div>
                    
                    <div id="graficos-container">
                        <!-- Aqui poderiam ser inseridos gr√°ficos -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== VARI√ÅVEIS GLOBAIS ==========
        let inventario = [];
        let locacoes = [];
        let contadorId = 1;

        // ========== NAVEGA√á√ÉO ENTRE ABAS ==========
        function showTab(tabName) {
            // Remove active de todas as abas e pain√©is
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
            
            // Adiciona active na aba clicada
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            // Atualiza dados espec√≠ficos da aba
            if (tabName === 'dashboard') {
                atualizarDashboard();
            } else if (tabName === 'inventario') {
                filtrarInventario();
            }
        }

        // ========== CADASTRO DE MATERIAIS ==========
        document.getElementById('form-cadastro').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Validar se o c√≥digo j√° existe
            const codigo = document.getElementById('codigo').value;
            if (inventario.some(item => item.codigo === codigo)) {
                alert('‚ùå Erro: C√≥digo j√° existe! Use um c√≥digo diferente.');
                return;
            }
            
            const item = {
                id: contadorId++,
                codigo: document.getElementById('codigo').value,
                categoria: document.getElementById('categoria').value,
                nome: document.getElementById('nome-item').value,
                quantidade: parseInt(document.getElementById('quantidade').value),
                unidade: document.getElementById('unidade').value,
                valorUnitario: parseFloat(document.getElementById('valor-unitario').value) || 0,
                localizacao: document.getElementById('localizacao').value,
                fornecedor: document.getElementById('fornecedor').value,
                notaFiscal: document.getElementById('nota-fiscal').value,
                observacoes: document.getElementById('observacoes').value,
                status: 'proprio',
                dataCadastro: new Date().toISOString().split('T')[0]
            };
            
            inventario.push(item);
            mostrarAlerta('‚úÖ Item cadastrado com sucesso!', 'success');
            this.reset();
            atualizarDashboard();
            salvarDados();
        });

        // ========== CADASTRO DE LOCA√á√ïES ==========
        document.getElementById('form-locacao').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const locacao = {
                id: contadorId++,
                nomeEvento: document.getElementById('evento-nome').value,
                dataEvento: document.getElementById('evento-data').value,
                empresaLocadora: document.getElementById('empresa-locadora').value,
                contatoEmpresa: document.getElementById('contato-empresa').value,
                itemLocado: document.getElementById('item-locado').value,
                quantidade: parseInt(document.getElementById('qtd-locada').value),
                valorLocacao: parseFloat(document.getElementById('valor-locacao').value),
                dataEntrega: document.getElementById('data-entrega').value,
                dataDevolucao: document.getElementById('data-devolucao').value,
                observacoes: document.getElementById('obs-locacao').value,
                status: 'ativo'
            };
            
            locacoes.push(locacao);
            
            // Adicionar ao invent√°rio como item alugado
            const itemInventario = {
                id: contadorId++,
                codigo: `LOC${locacao.id}`,
                categoria: 'alugado',
                nome: locacao.itemLocado,
                quantidade: locacao.quantidade,
                unidade: 'un',
                valorUnitario: locacao.valorLocacao / locacao.quantidade,
                localizacao: `Evento: ${locacao.nomeEvento}`,
                fornecedor: locacao.empresaLocadora,
                observacoes: `Loca√ß√£o para evento ${locacao.nomeEvento} - ${locacao.dataEvento}`,
                status: 'alugado',
                dataCadastro: new Date().toISOString().split('T')[0],
                dataEvento: locacao.dataEvento,
                dataDevolucao: locacao.dataDevolucao
            };
            
            inventario.push(itemInventario);
            mostrarAlerta('‚úÖ Loca√ß√£o registrada com sucesso!', 'success');
            this.reset();
            atualizarDashboard();
            atualizarLocacoes();
            salvarDados();
        });

        // ========== ATUALIZAR DASHBOARD ==========
        function atualizarDashboard() {
            const totalItens = inventario.length;
            const itensProprios = inventario.filter(item => item.status === 'proprio').length;
            const itensAlugados = inventario.filter(item => item.status === 'alugado').length;
            const valorTotal = inventario.reduce((total, item) => total + (item.quantidade * item.valorUnitario), 0);
            
            document.getElementById('total-itens').textContent = totalItens;
            document.getElementById('itens-proprios').textContent = itensProprios;
            document.getElementById('itens-alugados').textContent = itensAlugados;
            document.getElementById('valor-total').textContent = formatarMoeda(valorTotal);
            
            atualizarTabelaInventario();
            verificarAlertas();
        }

        // ========== ATUALIZAR TABELA DO INVENT√ÅRIO ==========
        function atualizarTabelaInventario() {
            const tbody = document.getElementById('inventory-tbody');
            tbody.innerHTML = '';
            
            inventario.forEach(item => {
                const row = tbody.insertRow();
                const valorTotal = item.quantidade * item.valorUnitario;
                row.innerHTML = `
                    <td><strong>${item.codigo}</strong></td>
                    <td>${item.nome}</td>
                    <td>${getCategoriaName(item.categoria)}</td>
                    <td>${item.quantidade} ${item.unidade}</td>
                    <td>${formatarMoeda(item.valorUnitario)}</td>
                    <td><strong>${formatarMoeda(valorTotal)}</strong></td>
                    <td><span class="status-badge status-${item.status}">${item.status === 'proprio' ? 'Pr√≥prio' : 'Alugado'}</span></td>
                    <td>${item.localizacao}</td>
                `;
            });
        }

        // ========== ATUALIZAR TABELA DE LOCA√á√ïES ==========
        function atualizarLocacoes() {
            const tbody = document.getElementById('locacoes-tbody');
            tbody.innerHTML = '';
            
            locacoes.forEach(locacao => {
                const row = tbody.insertRow();
                const hoje = new Date();
                const dataEvento = new Date(locacao.dataEvento);
                const dataDevolucao = new Date(locacao.dataDevolucao);
                
                let statusClass = 'status-alugado';
                let statusText = 'Ativo';
                
                if (dataDevolucao < hoje) {
                    statusClass = 'status-vencido';
                    statusText = 'Vencido';
                }
                
                row.innerHTML = `
                    <td><strong>${locacao.nomeEvento}</strong></td>
                    <td>${locacao.itemLocado}</td>
                    <td>${locacao.empresaLocadora}</td>
                    <td><strong>${formatarMoeda(locacao.valorLocacao)}</strong></td>
                    <td>${formatarData(locacao.dataEvento)}</td>
                    <td>${formatarDataHora(locacao.dataDevolucao)}</td>
                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                    <td>
                        <button onclick="finalizarLocacao(${locacao.id})" class="btn-small btn-success">‚úÖ Finalizar</button>
                    </td>
                `;
            });
        }

        // ========== CALCULADORAS ==========
        function calcularTotal() {
            const qtd = parseFloat(document.getElementById('calc-qtd').value) || 0;
            const valor = parseFloat(document.getElementById('calc-valor').value) || 0;
            const total = qtd * valor;
            document.getElementById('calc-total').value = formatarMoeda(total);
        }

        function calcularOrcamento() {
            let subtotal = 0;
            const itensContainer = document.getElementById('itens-orcamento');
            const itens = itensContainer.querySelectorAll('.calc-grid');
            
            itens.forEach(item => {
                const qtd = parseFloat(item.querySelector('.item-qtd')?.value) || 0;
                const valor = parseFloat(item.querySelector('.item-valor')?.value) || 0;
                const dias = parseFloat(item.querySelector('.item-dias')?.value) || 1;
                subtotal += qtd * valor * dias;
            });
            
            const desconto = parseFloat(document.getElementById('desconto').value) || 0;
            const total = subtotal * (1 - desconto / 100);
            
            document.getElementById('orcamento-subtotal').value = formatarMoeda(subtotal);
            document.getElementById('orcamento-total').value = formatarMoeda(total);
        }

        function analisarCustos() {
            const valorCompra = parseFloat(document.getElementById('valor-compra').value) || 0;
            const valorLocacao = parseFloat(document.getElementById('valor-locacao-evento').value) || 0;
            const usoAno = parseInt(document.getElementById('uso-ano').value) || 0;
            
            if (valorCompra === 0 || valorLocacao === 0 || usoAno === 0) {
                document.getElementById('recomendacao').value = 'Preencha todos os campos';
                return;
            }
            
            const custoAnualLocacao = valorLocacao * usoAno;
            const payback = valorCompra / valorLocacao;
            
            let recomendacao = '';
            if (custoAnualLocacao > valorCompra) {
                const economia = custoAnualLocacao - valorCompra;
                recomendacao = `üí∞ RECOMENDA√á√ÉO: COMPRAR - Economia de ${formatarMoeda(economia)}/ano`;
            } else if (payback <= 3) {
                recomendacao = `üìà RECOMENDA√á√ÉO: COMPRAR - Retorno em ${payback.toFixed(1)} usos`;
            } else {
                recomendacao = `üè¢ RECOMENDA√á√ÉO: ALUGAR - Mais econ√¥mico no momento`;
            }
            
            document.getElementById('recomendacao').value = recomendacao;
        }

        // ========== FUN√á√ïES AUXILIARES ==========
        function getCategoriaName(categoria) {
            const categorias = {
                'escritorio': 'üìù Escrit√≥rio',
                'informatica': 'üíª Inform√°tica',
                'mobiliario': 'ü™ë Mobili√°rio',
                'evento': 'üéâ Eventos',
                'limpeza': 'üßΩ Limpeza',
                'alugado': 'üè¢ Alugado',
                'outros': 'üì¶ Outros'
            };
            return categorias[categoria] || categoria;
        }

        function formatarMoeda(valor) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(valor);
        }

        function formatarData(data) {
            return new Date(data + 'T00:00:00').toLocaleDateString('pt-BR');
        }

        function formatarDataHora(dataHora) {
            return new Date(dataHora).toLocaleString('pt-BR');
        }

        function mostrarAlerta(mensagem, tipo) {
            const container = document.getElementById('alertas-container');
            const alerta = document.createElement('div');
            alerta.className = `alert alert-${tipo}`;
            alerta.innerHTML = mensagem;
            container.appendChild(alerta);
            
            // Remove o alerta ap√≥s 5 segundos
            setTimeout(() => {
                if (alerta.parentNode) {
                    alerta.parentNode.removeChild(alerta);
                }
            }, 5000);
        }

        // ========== FILTROS E BUSCAS ==========
        function filtrarInventario() {
            const filtro = document.getElementById('filtro-categoria').value;
            const tbody = document.getElementById('inventario-completo');
            tbody.innerHTML = '';
            
            const itensFiltrados = filtro ? inventario.filter(item => item.categoria === filtro) : inventario;
            
            itensFiltrados.forEach(item => {
                const row = tbody.insertRow();
                const valorTotal = item.quantidade * item.valorUnitario;
                row.innerHTML = `
                    <td><strong>${item.codigo}</strong></td>
                    <td>${item.nome}</td>
                    <td>${getCategoriaName(item.categoria)}</td>
                    <td>${item.quantidade}</td>
                    <td>${item.unidade}</td>
                    <td>${formatarMoeda(item.valorUnitario)}</td>
                    <td><strong>${formatarMoeda(valorTotal)}</strong></td>
                    <td><span class="status-badge status-${item.status}">${item.status === 'proprio' ? 'Pr√≥prio' : 'Alugado'}</span></td>
                    <td>${item.localizacao}</td>
                    <td>
                        <button onclick="editarItem(${item.id})" class="btn-small">‚úèÔ∏è Editar</button>
                        <button onclick="removerItem(${item.id})" class="btn-small btn-danger">üóëÔ∏è Remover</button>
                    </td>
                `;
            });
        }

        // Busca em tempo real
        document.getElementById('search-input').addEventListener('input', function() {
            const termo = this.value.toLowerCase();
            const rows = document.querySelectorAll('#dashboard-table tbody tr');
            
            rows.forEach(row => {
                const texto = row.textContent.toLowerCase();
                row.style.display = texto.includes(termo) ? '' : 'none';
            });
        });

        // ========== FUN√á√ïES DE GEST√ÉO ==========
        function editarItem(id) {
            const item = inventario.find(i => i.id === id);
            if (item && item.status === 'proprio') {
                showTab('cadastro');
                // Preencher formul√°rio com dados do item
                document.getElementById('codigo').value = item.codigo;
                document.getElementById('categoria').value = item.categoria;
                document.getElementById('nome-item').value = item.nome;
                document.getElementById('quantidade').value = item.quantidade;
                document.getElementById('unidade').value = item.unidade;
                document.getElementById('valor-unitario').value = item.valorUnitario;
                document.getElementById('localizacao').value = item.localizacao;
                document.getElementById('fornecedor').value = item.fornecedor;
                document.getElementById('nota-fiscal').value = item.notaFiscal;
                document.getElementById('observacoes').value = item.observacoes;
                
                // Remover o item antigo para permitir atualiza√ß√£o
                inventario = inventario.filter(i => i.id !== id);
                mostrarAlerta('üìù Item carregado para edi√ß√£o', 'warning');
            } else {
                mostrarAlerta('‚ùå N√£o √© poss√≠vel editar itens alugados', 'danger');
            }
        }

        function removerItem(id) {
            const item = inventario.find(i => i.id === id);
            if (confirm(`Tem certeza que deseja remover "${item.nome}"?`)) {
                inventario = inventario.filter(item => item.id !== id);
                // Se for item alugado, remove tamb√©m da lista de loca√ß√µes
                if (item.status === 'alugado') {
                    const codigoLocacao = parseInt(item.codigo.replace('LOC', ''));
                    locacoes = locacoes.filter(loc => loc.id !== codigoLocacao);
                }
                atualizarDashboard();
                filtrarInventario();
                atualizarLocacoes();
                salvarDados();
                mostrarAlerta('üóëÔ∏è Item removido com sucesso', 'warning');
            }
        }

        function finalizarLocacao(id) {
            if (confirm('Confirma que a loca√ß√£o foi finalizada e o item devolvido?')) {
                const locacao = locacoes.find(l => l.id === id);
                if (locacao) {
                    locacao.status = 'finalizado';
                    // Remove do invent√°rio
                    inventario = inventario.filter(item => item.codigo !== `LOC${id}`);
                    atualizarDashboard();
                    atualizarLocacoes();
                    salvarDados();
                    mostrarAlerta('‚úÖ Loca√ß√£o finalizada com sucesso', 'success');
                }
            }
        }

        function limparFormulario() {
            document.getElementById('form-cadastro').reset();
        }

        // ========== ADICIONAR ITEM AO OR√áAMENTO ==========
        function adicionarItemOrcamento() {
            const container = document.getElementById('itens-orcamento');
            const novoItem = document.createElement('div');
            novoItem.innerHTML = `
                <div class="calc-grid" style="margin-top: 15px; padding-top: 15px; border-top: 2px solid #e9ecef;">
                    <div class="form-group">
                        <label>Item:</label>
                        <input type="text" placeholder="Nome do item" class="item-nome">
                    </div>
                    <div class="form-group">
                        <label>Qtd:</label>
                        <input type="number" min="1" value="1" class="item-qtd" oninput="calcularOrcamento()">
                    </div>
                    <div class="form-group">
                        <label>Valor Unit. (R$):</label>
                        <input type="number" step="0.01" class="item-valor" oninput="calcularOrcamento()">
                    </div>
                    <div class="form-group">
                        <label>Dias:</label>
                        <input type="number" min="1" value="1" class="item-dias" oninput="calcularOrcamento()">
                    </div>
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <button type="button" onclick="this.closest('div').parentNode.remove(); calcularOrcamento();" class="btn-danger" style="width: 100%;">‚ùå Remover Este Item</button>
                    </div>
                </div>
            `;
            container.appendChild(novoItem);
        }

        // ========== VERIFICAR ALERTAS ==========
        function verificarAlertas() {
            const hoje = new Date();
            let alertas = [];
            
            // Verificar loca√ß√µes vencidas
            locacoes.forEach(locacao => {
                const dataDevolucao = new Date(locacao.dataDevolucao);
                if (dataDevolucao < hoje && locacao.status === 'ativo') {
                    alertas.push(`‚ö†Ô∏è Loca√ß√£o vencida: ${locacao.itemLocado} (Evento: ${locacao.nomeEvento})`);
                }
            });
            
            // Verificar loca√ß√µes pr√≥ximas ao vencimento (pr√≥ximos 2 dias)
            const doisDias = new Date();
            doisDias.setDate(hoje.getDate() + 2);
            
            locacoes.forEach(locacao => {
                const dataDevolucao = new Date(locacao.dataDevolucao);
                if (dataDevolucao > hoje && dataDevolucao <= doisDias && locacao.status === 'ativo') {
                    alertas.push(`üìÖ Devolu√ß√£o pr√≥xima: ${locacao.itemLocado} (${formatarDataHora(locacao.dataDevolucao)})`);
                }
            });
            
            // Mostrar alertas
            alertas.forEach(alerta => {
                mostrarAlerta(alerta, 'warning');
            });
        }

        // ========== FUN√á√ïES DE RELAT√ìRIO ==========
        function gerarRelatorioMovimentacao() {
            const periodoDE = document.getElementById('periodo-de').value;
            const periodoATE = document.getElementById('periodo-ate').value;
            
            if (!periodoDE || !periodoATE) {
                mostrarAlerta('üìÖ Selecione o per√≠odo para o relat√≥rio', 'warning');
                return;
            }
            
            const itensPeriodo = inventario.filter(item => {
                const dataItem = new Date(item.dataCadastro);
                const dataInicio = new Date(periodoDE);
                const dataFim = new Date(periodoATE);
                dataFim.setDate(dataFim.getDate() + 1); // Incluir o √∫ltimo dia
                return dataItem >= dataInicio && dataItem < dataFim;
            });
            
            mostrarAlerta(`üìä Relat√≥rio gerado: ${itensPeriodo.length} itens movimentados no per√≠odo`, 'success');
            console.log('Relat√≥rio de Movimenta√ß√£o:', itensPeriodo);
        }

        function gerarRelatorioLocacoes() {
            const periodoDE = document.getElementById('periodo-de').value;
            const periodoATE = document.getElementById('periodo-ate').value;
            
            if (!periodoDE || !periodoATE) {
                mostrarAlerta('üìÖ Selecione o per√≠odo para o relat√≥rio', 'warning');
                return;
            }
            
            const locacoesPeriodo = locacoes.filter(locacao => {
                const dataEvento = new Date(locacao.dataEvento);
                const dataInicio = new Date(periodoDE);
                const dataFim = new Date(periodoATE);
                dataFim.setDate(dataFim.getDate() + 1);
                return dataEvento >= dataInicio && dataEvento < dataFim;
            });
            
            const totalGasto = locacoesPeriodo.reduce((total, locacao) => total + locacao.valorLocacao, 0);
            const mediaEvento = locacoesPeriodo.length > 0 ? totalGasto / locacoesPeriodo.length : 0;
            
            document.getElementById('total-gasto-locacao').textContent = formatarMoeda(totalGasto);
            document.getElementById('total-eventos').textContent = locacoesPeriodo.length;
            document.getElementById('media-evento').textContent = formatarMoeda(mediaEvento);
            
            mostrarAlerta(`üè¢ Relat√≥rio de Loca√ß√µes: ${locacoesPeriodo.length} eventos, total: ${formatarMoeda(totalGasto)}`, 'success');
        }

        function gerarRelatorioValores() {
            const valorTotalInventario = inventario
                .filter(item => item.status === 'proprio')
                .reduce((total, item) => total + (item.quantidade * item.valorUnitario), 0);
            
            const valorTotalLocacoes = locacoes
                .filter(loc => loc.status === 'ativo')
                .reduce((total, locacao) => total + locacao.valorLocacao, 0);
            
            // Estimativa de economia: assume-se que materiais pr√≥prios economizam 60% vs loca√ß√£o
            const economiaEstimada = valorTotalInventario * 0.6;
            
            document.getElementById('economia-estimada').textContent = formatarMoeda(economiaEstimada);
            
            mostrarAlerta(`üí∞ Relat√≥rio Financeiro gerado - Valor do estoque: ${formatarMoeda(valorTotalInventario)}`, 'success');
        }

        function gerarRelatorioCompleto() {
            gerarRelatorioMovimentacao();
            setTimeout(() => gerarRelatorioLocacoes(), 500);
            setTimeout(() => gerarRelatorioValores(), 1000);
        }

        // ========== FUN√á√ïES DE EXPORTA√á√ÉO ==========
        function exportarDados() {
            const dados = {
                inventario: inventario,
                locacoes: locacoes,
                dataExportacao: new Date().toISOString()
            };
            
            const jsonString = JSON.stringify(dados, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `almoxarifado_backup_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            mostrarAlerta('üìä Dados exportados com sucesso!', 'success');
        }

        function imprimirInventario() {
            window.print();
        }

        function backupDados() {
            exportarDados();
            mostrarAlerta('üíæ Backup criado com sucesso!', 'success');
        }

        // ========== PERSIST√äNCIA DE DADOS ==========
        function salvarDados() {
            const dados = {
                inventario: inventario,
                locacoes: locacoes,
                contadorId: contadorId
            };
            // Em ambiente real, aqui seria feita a integra√ß√£o com banco de dados ou Google Sheets
            console.log('Dados salvos:', dados);
        }

        function carregarDados() {
            // Em ambiente real, aqui carregaria os dados salvos
            // Por agora, mant√©m dados de exemplo
        }

        // ========== DADOS DE EXEMPLO ==========
        function inicializarDados() {
            // Limpar dados existentes
            inventario = [];
            locacoes = [];
            contadorId = 1;
            
            // Adicionar itens de exemplo
            const itensExemplo = [
                {
                    id: contadorId++,
                    codigo: 'ESC001',
                    categoria: 'escritorio',
                    nome: 'Papel A4 75g - Resma',
                    quantidade: 15,
                    unidade: 'resma',
                    valorUnitario: 22.50,
                    localizacao: 'Arm√°rio 1 - Prateleira A',
                    fornecedor: 'Papelaria Central Ltda',
                    notaFiscal: 'NF001234',
                    observacoes: 'Estoque para uso geral da secretaria',
                    status: 'proprio',
                    dataCadastro: '2024-09-01'
                },
                {
                    id: contadorId++,
                    codigo: 'INF001',
                    categoria: 'informatica',
                    nome: 'Notebook Dell Inspiron 15 3000',
                    quantidade: 3,
                    unidade: 'un',
                    valorUnitario: 2850.00,
                    localizacao: 'Sala de TI - Mesa 02',
                    fornecedor: 'TechCorp Inform√°tica',
                    notaFiscal: 'NF005678',
                    observacoes: 'Para uso em eventos e apresenta√ß√µes externas',
                    status: 'proprio',
                    dataCadastro: '2024-08-15'
                },
                {
                    id: contadorId++,
                    codigo: 'EVT001',
                    categoria: 'evento',
                    nome: 'Banner Roll-up 80x200cm',
                    quantidade: 5,
                    unidade: 'un',
                    valorUnitario: 180.00,
                    localizacao: 'Dep√≥sito - Estante C',
                    fornecedor: 'Gr√°fica Visual',
                    notaFiscal: 'NF009876',
                    observacoes: 'Material para divulga√ß√£o em eventos',
                    status: 'proprio',
                    dataCadastro: '2024-09-10'
                }
            ];
            
            inventario.push(...itensExemplo);
            
            // Adicionar loca√ß√µes de exemplo
            const locacaoExemplo = {
                id: contadorId++,
                nomeEvento: 'Workshop de Empreendedorismo Digital',
                dataEvento: '2024-09-30',
                empresaLocadora: 'SoundTech Loca√ß√µes',
                contatoEmpresa: '(21) 99999-8888',
                itemLocado: 'Sistema de Som Profissional + Microfones',
                quantidade: 1,
                valorLocacao: 450.00,
                dataEntrega: '2024-09-30T08:00',
                dataDevolucao: '2024-09-30T18:00',
                observacoes: 'Inclui mesa de som, 2 microfones sem fio e caixas amplificadas',
                status: 'ativo'
            };
            
            locacoes.push(locacaoExemplo);
            
            // Adicionar item alugado ao invent√°rio
            const itemAlugado = {
                id: contadorId++,
                codigo: `LOC${locacaoExemplo.id}`,
                categoria: 'alugado',
                nome: locacaoExemplo.itemLocado,
                quantidade: locacaoExemplo.quantidade,
                unidade: 'un',
                valorUnitario: locacaoExemplo.valorLocacao,
                localizacao: `Evento: ${locacaoExemplo.nomeEvento}`,
                fornecedor: locacaoExemplo.empresaLocadora,
                observacoes: `Loca√ß√£o para ${locacaoExemplo.nomeEvento} - ${locacaoExemplo.dataEvento}`,
                status: 'alugado',
                dataCadastro: new Date().toISOString().split('T')[0],
                dataEvento: locacaoExemplo.dataEvento,
                dataDevolucao: locacaoExemplo.dataDevolucao
            };
            
            inventario.push(itemAlugado);
        }

        // ========== INICIALIZA√á√ÉO DO SISTEMA ==========
        window.addEventListener('load', function() {
            inicializarDados();
            atualizarDashboard();
            atualizarLocacoes();
            filtrarInventario();
            
            // Definir data padr√£o para relat√≥rios (√∫ltimo m√™s)
            const hoje = new Date();
            const umMesAtras = new Date();
            umMesAtras.setMonth(hoje.getMonth() - 1);
            
            document.getElementById('periodo-de').value = umMesAtras.toISOString().split('T')[0];
            document.getElementById('periodo-ate').value = hoje.toISOString().split('T')[0];
            
            mostrarAlerta('üéâ Sistema de Almoxarifado carregado com sucesso!', 'success');
            
            // Executar verifica√ß√£o de alertas ap√≥s 2 segundos
            setTimeout(verificarAlertas, 2000);
        });

        // ========== EVENTOS DE TECLADO ==========
        document.addEventListener('keydown', function(e) {
            // Ctrl + S para salvar dados
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                salvarDados();
                mostrarAlerta('üíæ Dados salvos manualmente!', 'success');
            }
        });
    </script>
</body>
</html>